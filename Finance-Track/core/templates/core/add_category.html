{% extends 'core/base.html' %}

{% block title %}{% if is_edit %}Edit Category{% else %}Add Category{% endif %} - Finance Tracker{% endblock %}

{% block content %}
<h2>{% if is_edit %}Edit Category{% else %}Add Category{% endif %}</h2>

{% if is_edit and category %}
<div style="background: #d1ecf1; border: 1px solid #bee5eb; border-radius: 0.25rem; padding: 1rem; margin-bottom: 1.5rem;">
    <p style="margin: 0; color: #0c5460;">
        <strong>Editing:</strong> {{ category.name }} ({{ category.get_category_type_display }})
    </p>
</div>
{% endif %}

<form method="post" id="categoryForm">
    {% csrf_token %}
    
    <div class="row">
        <div class="col">
            <label for="{{ form.name.id_for_label }}">Category Name:</label>
            {{ form.name }}
        </div>
        
        <div class="col">
            <label for="{{ form.category_type.id_for_label }}">Category Type:</label>
            {{ form.category_type }}
        </div>
    </div>
    
    <div id="parentField">
        <label for="{{ form.parent.id_for_label }}">Parent Category:</label>
        {{ form.parent }}
        <small style="display: block; color: #6c757d; margin-top: 0.25rem;">
            Leave empty to create a main category, or select a parent to create a subcategory (only for expense categories)
        </small>
    </div>
    
    <div>
        <label for="{{ form.description.id_for_label }}">Description (Optional):</label>
        {{ form.description }}
    </div>
    
    <div>
        <button type="submit" class="btn btn-primary">
            {% if is_edit %}Update Category{% else %}Add Category{% endif %}
        </button>
        <a href="{% url 'categories_list' %}" class="btn">Cancel</a>
    </div>
</form>

<script>
    // Update parent category options based on selected category type
    document.addEventListener('DOMContentLoaded', function() {
        const categoryTypeSelect = document.getElementById('{{ form.category_type.id_for_label }}');
        const parentField = document.getElementById('parentField');
        const parentSelect = document.getElementById('{{ form.parent.id_for_label }}');
        
        if (categoryTypeSelect && parentField && parentSelect) {
            function updateParentField() {
                const selectedType = categoryTypeSelect.value;
                
                // Only show parent field for expense categories
                if (selectedType === 'expense') {
                    parentField.style.display = 'block';
                    parentSelect.disabled = false;
                } else {
                    parentField.style.display = 'none';
                    parentSelect.disabled = true;
                    parentSelect.value = ''; // Clear selection
                }
            }
            
            categoryTypeSelect.addEventListener('change', updateParentField);
            
            // Trigger on page load to set initial state
            updateParentField();
        }
    });
</script>
{% endblock %}
